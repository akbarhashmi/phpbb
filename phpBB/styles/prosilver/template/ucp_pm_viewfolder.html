{% include 'ucp_header.html' %}

{% if not PROMPT %}
	{% include 'ucp_pm_message_header.html' %}
{% endif %}

	</div>
</div>

{% if messagerow %}
<div class="pm">
	<ul class="pm-list">
		{% for message in messagerow %}
		<li class="pm-item">
			<span class="pm-primary">
				{% if message.S_PM_UNREAD %}
					<i class="fa fa-certificate fa-fw pm-unread" title="{{ lang('UCP_PM_UNREAD') }}" aria-label="{{ lang('UCP_PM_UNREAD') }}"></i>
				{% endif %}

				{% if message.S_PM_MARKED %}
					<i class="fa fa-star fa-fw pm-marked" title="{{ lang('UCP_PM_MARKED') }}" aria-label="{{ lang('UCP_PM_MARKED') }}"></i>
				{% endif %}

				<a href="{{ message.U_VIEW_PM }}" title="{{ message.SUBJECT }}" class="pm-title{% if message.S_PM_UNREAD %} pm-unread{% endif %}">{{ message.SUBJECT }}</a>
				<span class="pm-secondary">
					<span class="pm-secondary-item pm-authour">
						{% if message.S_AUTHOR_FOE %}
							<i class="fa fa-ban fa-fw" title="{{ lang('PM_AUTHOR_FOE', message.MESSAGE_AUTHOR) }}" aria-label="{{ lang('PM_AUTHOR_FOE', message.MESSAGE_AUTHOR) }}"></i>
						{% else %}
							<i class="fa fa-user fa-fw" aria-hidden="true"></i>
						{% endif %}

						{% if S_SHOW_RECIPIENTS %}
							{{ lang('MESSAGE_TO') }} {{ message.RECIPIENTS }}
						{% else %}
							{{ message.MESSAGE_AUTHOR_FULL }}
						{% endif %}
					</span>
					<span class="pm-secondary-item pm-date">
						<i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>
						{{ message.SENT_TIME }}
					</span>
				</span>
			</span>
		</li>
		{% endfor %}
	</ul>
	<div class="pm-viewer">
		<div class="pm-message">
			{% for history in history_row %}
				<ul class="pm-message-list{% if history.S_NOT_SELF %} pm-not-self{% endif %}">
					<li class="pm-message-item ">
						<span class="pm-message-primary">
							<span class="pm-message-primary-item">
								<span class="pm-message-authour">
									<i class="fa fa-user fa-fw" title="{{ message.MESSAGE_AUTHOR }}" aria-label="{{ message.MESSAGE_AUTHOR }}"></i>
									{{ history.MESSAGE_AUTHOR_FULL }}
									<!--Maybe add recipient here-->
								</span>
								<span class="pm-message-date">
									<i class="fa fa-clock-o fa-fw" title="{{ message.SENT_TIME }}" aria-label="{{ message.SENT_TIME }}"></i>
									{{ history.SENT_DATE }}
									<!--<p id="pm-time"></p>-->

								</span>
							</span>
							<span class="pm-message-secondary">
								{% if history.S_CURRENT_MSG %}
									<!--Some way to indicate this is the message clicked, change of color isn't good enough-->
									<!--<i class="fa fa-certificate fa-fw msg-unread" title="Unread message" aria-label="Unread message"></i>-->
								{% endif %}
								<a href="{{ history.U_VIEW_MESSAGE }}" class="pm-message-title{% if history.S_CURRENT_MSG %} pm-message-unread{% endif %}">{{ history.SUBJECT }}</a>
								<br />
								{% if history.MESSAGE %}
									{{ history.MESSAGE }}
								{% else %}
									<span class="error">{{ lang('MESSAGE_REMOVED_FROM_OUTBOX') }}</span>
								{% endif %}
							</span>
						</span>
					</li>
				</ul>
			{% endfor %}
		</div>

		<div class="pm-compose">
			{% if S_TO_RECIPIENT %}
				<div class="pm-subject-box">
					<input type="text" name="subject" id="subject" maxlength="<!-- IF S_NEW_MESSAGE -->120<!-- ELSE -->124<!-- ENDIF -->" tabindex="2" value="{SUBJECT}{DRAFT_SUBJECT}" class="pm-inputbox" />
				</div>
				<div class="pm-recipient-box">
					<textarea id="username_list" name="username_list" class="inputbox" cols="50" rows="2" tabindex="1"></textarea>
					<dd class="recipients">
						<input type="submit" name="add_to" value="{L_ADD}" class="button1 button button-form-bold" tabindex="1" />
						<input type="submit" name="add_bcc" value="{L_ADD_BCC}" class="button1 button button-form-bold" tabindex="1" />
						<!-- IF .to_recipient -->
						<div class="pm-recipient-cc">
							{L_TO_MASS}{L_COLON}
							<ul class="recipients">
								<!-- BEGIN to_recipient -->
								<li>
									<!-- IF not S_EDIT_POST --><input type="submit" name="remove_{to_recipient.TYPE}[{to_recipient.UG_ID}]" value="x" class="button1 button button-form-bold" /><!-- ENDIF -->
									<!-- IF to_recipient.IS_GROUP --><a href="{to_recipient.U_VIEW}">{to_recipient.NAME}</a><!-- ELSE -->{to_recipient.NAME_FULL}<!-- ENDIF -->
								</li>
								<!-- END to_recipient -->
							</ul>
						</div>
						<!-- ENDIF -->
						<!-- IF .bcc_recipient -->
						<div class="pm-recipient-bcc">
							{L_BCC}{L_COLON}
							<ul class="recipients">
								<!-- BEGIN bcc_recipient -->
								<li>
									<!-- IF not S_EDIT_POST --><input type="submit" name="remove_{bcc_recipient.TYPE}[{bcc_recipient.UG_ID}]" value="x" class="button1 button button-form-bold" /><!-- ENDIF -->
									<!-- IF bcc_recipient.IS_GROUP --><a href="{bcc_recipient.U_VIEW}">{bcc_recipient.NAME}</a><!-- ELSE -->{bcc_recipient.NAME_FULL}<!-- ENDIF -->
								</li>
								<!-- END bcc_recipient -->
							</ul>
						</div>
						<!-- ENDIF -->
				</div>
				<!-- INCLUDE posting_buttons.html -->
				<div id="pm-message-box" class="pm-message-box">
					<textarea name="message" id="message" rows="15" cols="76" tabindex="4" onselect="storeCaret(this);" onclick="storeCaret(this);" onkeyup="storeCaret(this);" onfocus="initInsertions();" class="pm-inputbox">{DRAFT_MESSAGE}{SIGNATURE}</textarea>
					<div class="pm-smiley-box">
						<!-- IF S_SMILIES_ALLOWED and .smiley -->
							<!-- BEGIN smiley -->
								<a href="#" onclick="insert_text('{smiley.A_SMILEY_CODE}', true); return false;"><img src="{smiley.SMILEY_IMG}" width="{smiley.SMILEY_WIDTH}" height="{smiley.SMILEY_HEIGHT}" alt="{smiley.SMILEY_CODE}" title="{smiley.SMILEY_DESC}" /></a>
							<!-- END smiley -->
						<!-- ENDIF -->
						<!-- IF BBCODE_STATUS -->
							<span class="pm-bbcode-status">
								{BBCODE_STATUS}<br />
								<!-- IF S_BBCODE_ALLOWED -->
									{IMG_STATUS}<br />
									{FLASH_STATUS}<br />
									{URL_STATUS}<br />
								<!-- ENDIF -->
								{SMILIES_STATUS}
							</span>
						<!-- ENDIF -->
					</div>
				</div>

				<div class="pm-message-buttons">
					{S_HIDDEN_ADDRESS_FIELD}
					{S_HIDDEN_FIELDS}
					<input type="submit" tabindex="5" name="preview" value="{L_PREVIEW}" class="button1 button button-form"<!-- IF not S_PRIVMSGS --> onclick="document.getElementById('postform').action += '#preview';"<!-- ENDIF --> />&nbsp;
					<input type="submit" accesskey="s" tabindex="6" name="post" value="{L_SUBMIT}" class="button1 button button-form default-submit-action" />&nbsp;
				</div>
				<!-- IF S_DISPLAY_PREVIEW -->
					<div class="pm-preview">
						<div class="pm-preview-title">
							{L_PREVIEW}{L_COLON} {PREVIEW_SUBJECT}
						</div>
						<div class="pm-preview-content">
							{PREVIEW_MESSAGE}
						</div>
						<!-- IF PREVIEW_SIGNATURE --><div class="pm-signature">{PREVIEW_SIGNATURE}</div><!-- ENDIF -->
					</div>
				<!-- ENDIF -->
			{% endif %}
		</div>
	</div>
</div>

<div class="action-bar bottom">
	{% include 'display_options.html' %}
	<input type="hidden" name="cur_folder_id" value="{{ CUR_FOLDER_ID }}" />

	<div class="pagination">
		{{ TOTAL_MESSAGES }}
		{% if pagination %}
			{% include 'pagination.html' %}
		{% else %}
			&bull; {{ PAGE_NUMBER }}
		{% endif %}
	</div>
</div>
{% endif %}

{% include 'ucp_pm_message_footer.html' %}
{% include 'ucp_footer.html' %}

<!--WIP-->
<!--<script src="https://cdn.jsdelivr.net/momentjs/2.13.0/moment.min.js"></script>-->
<!--<script>-->
	<!--var date = '2015-04-03';-->
	<!--var format = 'LLLL';-->
	<!--var egg = moment(date).format(format);-->
	<!--document.getElementById("pm-time").innerHTML = egg;-->
	<!--alert(egg);-->
<!--</script>-->