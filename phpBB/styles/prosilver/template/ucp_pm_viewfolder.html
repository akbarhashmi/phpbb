{% include 'ucp_header.html' %}

{% if not PROMPT %}
	{% include 'ucp_pm_message_header.html' %}
{% endif %}

	</div>
</div>

{% if messagerow %}
<div class="pm">
	<ul class="pm-list">
		{% for message in messagerow %}
		<li class="pm-item">
			<span class="pm-primary">
				{% if message.S_PM_UNREAD %}
					<i class="fa fa-certificate fa-fw pm-unread" title="{{ lang('UCP_PM_UNREAD') }}" aria-label="{{ lang('UCP_PM_UNREAD') }}"></i>
				{% endif %}

				{% if message.S_PM_MARKED %}
					<i class="fa fa-star fa-fw pm-marked" title="{{ lang('UCP_PM_MARKED') }}" aria-label="{{ lang('UCP_PM_MARKED') }}"></i>
				{% endif %}

				<a class="pm-title{% if message.S_PM_UNREAD %} pm-unread{% endif %}" href="{{ message.U_VIEW_PM }}" title="{{ message.SUBJECT }}" >{{ message.SUBJECT }}</a>
				<span class="pm-secondary">
					<span class="pm-secondary-item pm-author">
						{% if message.S_AUTHOR_FOE %}
							<i class="fa fa-ban fa-fw" title="{{ lang('PM_AUTHOR_FOE', message.MESSAGE_AUTHOR) }}" aria-label="{{ lang('PM_AUTHOR_FOE', message.MESSAGE_AUTHOR) }}"></i>
						{% else %}
							<i class="fa fa-user fa-fw" aria-hidden="true"></i>
						{% endif %}

						{% if S_SHOW_RECIPIENTS %}
							{{ message.RECIPIENTS }}
						{% endif %}
					</span>
					<span class="pm-secondary-item pm-date">
						<i class="fa fa-clock-o fa-fw" aria-hidden="true"></i>
						{{ message.SENT_TIME }} {{ S_SOME_VARIABLE }}
					</span>
				</span>
			</span>
		</li>
		{% endfor %}
	</ul>
	<div class="pm-viewer">
		{% if history_row %}
		<div class="pm-message-header">
			<div class="pm-subject">
				{SUBJECT}
			</div>
			<svg xmlns="http://www.w3.org/2000/svg" class="post-icons" style="position: absolute; width: 0; height: 0;">
				<symbol id="edit-full" viewBox="0 0 24 24">
					<path fill-rule="evenodd" d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"
					/>
				</symbol>
				<symbol id="forward" viewBox="0 0 24 24">
					<path fill-rule="evenodd" d="M12.707 2.293l9 9a.999.999 0 0 1 0 1.414l-9 9A1 1 0 0 1 11 21v-4H3a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h8V3a1.002 1.002 0 0 1 1.707-.707zM13 8a1 1 0 0 1-1 1H4v6h8a1 1 0 0 1 1 1v2.586L19.586 12 13 5.414V8z" />
				</symbol>
				<symbol id="trash" viewBox="0 0 24 24">
					<path fill-rule="nonzero" d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
				</symbol>
				<symbol id="add" viewBox="0 0 24 24">
					<path fill-rule="evenodd" d="M20 8h-4V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v4H4a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2zm0 6h-6l-.003 6H10v-6H4v-4h6V4h4v6h6v4z" />
				</symbol>
				<symbol id="important" viewBox="0 0 24 24">
					<path fill-rule="evenodd" d="M12 17.27L18.18 21l-1.64-7.03L22 9.24l-7.19-.61L12 2 9.19 8.63 2 9.24l5.46 4.73L5.82 21z"/>
				</symbol>
			</svg>
			<span class="pm-buttons">
				<button class="pm-button" id="pm-topp-button" type="button">
						<svg class="o-icon o-bar-action-icon"><use xlink:href="#important"></use></svg>
				</button>
				<button class="pm-to-button" id="pm-topp-button" type="button">
						<svg class="o-icon o-bar-action-icon"><use xlink:href="#edit-full"></use></svg>
				</button>
				<button class="pm-to-button" id="pm-topp-button" type="button">
						<svg class="o-icon o-bar-action-icon"><use xlink:href="#trash"></use></svg>
				</button>
				<button class="pm-to-button" id="pm-topp-button" type="button">
						<svg class="o-icon o-bar-action-icon"><use xlink:href="#add"></use></svg>
				</button>
				<button class="pm-to-button" id="pm-topp-button" type="button">
						<svg class="o-icon o-bar-action-icon"><use xlink:href="#forward"></use></svg>
				</button>
				<button class="pm-to-button" id="pm-to-button" type="button">
					<i class="fa fa-user fa-fw" ></i>
				</button>
			</span>
			<div class="pm-to-model" id="pm-to-model">
				<div class="pm-modal-content">
					<span class="pm-to-button-close">&times;</span>
					<div class="pm-recipient-box">
						<textarea class="inputbox" id="username_list" name="username_list"  cols="50" rows="2" tabindex="1"></textarea>
						<dd class="recipients">
							<input class="button1 button button-form-bold" name="add_to" tabindex="1" type="submit" value="{{ lang('ADD') }}" >
							<input class="button1 button button-form-bold" name="add_bcc" tabindex="1" type="submit"  value="{{ lang('ADD_BCC') }}" >
							{% if to_recipient %}
							<div class="pm-recipient-cc">
								{{ lang('TO_MASS') }} {{ lang('COLON') }}
								<ul class="pm-recipient-list">
									{% for recipient in to_recipient %}
									<li class="pm-recipient">
										{% if not S_EDIT_POST %}<input class="button1 button button-form-bold" name="remove_{recipient.TYPE}[{recipient.UG_ID}]"  type="submit" value="x" >{% endif %}
										{% if recipient.IS_GROUP %}<a href="{recipient.U_VIEW}">{{ recipient.NAME }}</a>{% else %}{{ recipient.NAME_FULL }}{% endif %}
									</li>
									{% endfor %}
								</ul>
							</div>
							{% endif %}
							{% if bcc_recipient %}
							<div class="pm-recipient-bcc">
								{{ lang('BCC') }} {{ lang('COLON') }}
								<ul class="pm-recipient-list">
									{% for recipient in bcc_recipient %}
									<li class="pm-recipient">
										{% if not S_EDIT_POST %}<input class="button1 button button-form-bold" name="remove_{recipient.TYPE}[{recipient.UG_ID}]" type="submit" value="x" >{% endif %}
										{% if bcc_recipient.IS_GROUP %}<a class="pm-recipient-link" href="{{ recipient.U_VIEW }}">{{ recipient.NAME }}</a>{% else %}{{ recipient.NAME_FULL }}{% endif %}
									</li>
									{% endfor %}
								</ul>
							</div>
							{% endif %}
						</dd>
					</div>
				</div>
			</div>
		</div>
		{% endif %}
		{% EVENT ucp_pm_history_review_before %}
		<div class="pm-message">
			{% for history in history_row %}
				<ul class="pm-message-list{% if not history.S_IS_SELF %} pm-not-self{% endif %}">
					<li class="pm-message-item ">
						<span class="pm-message-primary">
							<span class="pm-message-primary-item">
								<div class="pm-message-author">
									<i class="fa fa-user fa-fw" title="{{ message.MESSAGE_AUTHOR }}" aria-label="{{ message.MESSAGE_AUTHOR }}"></i>
									{{ history.MESSAGE_AUTHOR_FULL }}
									<!--Maybe add recipient here-->
								</div>
								<div class="pm-message-date">
									<i class="fa fa-clock-o fa-fw" title="{{ message.SENT_TIME }}" aria-label="{{ message.SENT_TIME }}"></i>
									{{ history.SENT_DATE }}
									<!--<p id="pm-time"></p>-->

								</div>
							</span>
							<span class="pm-message-secondary">
								{% if history.S_CURRENT_MSG %}
									<!--Some way to indicate this is the message clicked, change of color isn't good enough-->
									<!--<i class="fa fa-certificate fa-fw msg-unread" title="Unread message" aria-label="Unread message"></i>-->
								{% endif %}
								<a class="pm-message-title{% if history.S_CURRENT_MSG %} pm-message-unread{% endif %}" href="{{ history.U_VIEW_MESSAGE }}" >{{ history.SUBJECT }}</a>
								<br>
								{% if history.MESSAGE %}
									{{ history.MESSAGE }}
								{% else %}
									<span class="error">{{ lang('MESSAGE_REMOVED_FROM_OUTBOX') }}</span>
								{% endif %}
							</span>
						</span>
					</li>
				</ul>
			{% endfor %}
		</div>
		{% EVENT ucp_pm_history_review_before %}

		<div class="pm-compose">
			<div class="pm-subject-box">
				<input class="pm-inputbox" id="subject" name="subject" maxlength="{% if S_NEW_MESSAGE %}120{% else %}124{% endif %}" tabindex="2" type="text" placeholder="{{ lang('PM_TITLE') }}" >
			</div>
			
			<div class="pm-message-box" id="pm-message-box" >
				{% include 'posting_buttons.html' %}
				<button class="pm-smile-button" id="pm-smile-button" type="button">Smile Modal</button>
				<div class="pm-smile-model" id="pm-smile-model">
					<div class="pm-modal-content">
						<span class="pm-button-close">&times;</span>
						{% include 'posting_buttons.html' %}
					</div>
				</div>

				<textarea class="pm-inputbox" id="message" name="message" rows="15" cols="76" tabindex="4" placeholder="{{ lang('PM_MESSAGE') }}" onselect="storeCaret(this);" onclick="storeCaret(this);" onkeyup="storeCaret(this);" onfocus="initInsertions();" >{{ DRAFT_MESSAGE }}{{ SIGNATURE }}</textarea>
				<div class="pm-smiley-box">
					{% if S_SMILIES_ALLOWED and smiley %}
						{% for smile in smiley %}
							<a class="pm-smiley-code" href="#" onclick="insert_text('{smile.A_SMILEY_CODE}', true); return false;"><img class="pm-smiley-img" title="{smile.SMILEY_DESC}" src="{smile.SMILEY_IMG}" width="{smile.SMILEY_WIDTH}" height="{smile.SMILEY_HEIGHT}" alt="{smile.SMILEY_CODE}" ></a>
						{% endfor %}
					{% endif %}
					{% if BBCODE_STATUS %}
						<ul class="pm-bbcode-status">
							<li><{{ BBCODE_STATUS }}</li>
							{% if S_BBCODE_ALLOWED %}
								<li>{{ IMG_STATUS }}</li>
								<li>{{ FLASH_STATUS }}</li>
								<li>{{ URL_STATUS }}</li>
							{% endif %}
							<li>{{ SMILIES_STATUS }}</li>
						</ul>
					{% endif %}
				</div>
				<div class="pm-message-buttons">
					{{ S_HIDDEN_ADDRESS_FIELD }}
					{{ S_HIDDEN_FIELDS }}
					<input class="button1 button button-form" name="preview" tabindex="5"  {% if not S_PRIVMSGS %} onclick="document.getElementById('postform').action += '#preview';"{% endif %} value="{{ lang('PREVIEW') }}" type="submit" >&nbsp;
					<input class="button1 button button-form default-submit-action" name="post" accesskey="s" tabindex="6" value="{{ lang('SUBMIT') }}" type="submit" >&nbsp;
				</div>
			</div>
			{% if S_DISPLAY_PREVIEW %}
				<div class="pm-preview">
					<div class="pm-preview-title">
						{{ lang('PREVIEW') }} {{ lang('COLON') }} {{ PREVIEW_SUBJECT }}
					</div>
					<div class="pm-preview-content">
						{{ PREVIEW_MESSAGE }}
					</div>
					{% if PREVIEW_SIGNATURE %}<div class="pm-signature">{{ PREVIEW_SIGNATURE }}</div>{% endif %}
				</div>
			{% endif %}
		</div>
	</div>
</div>

<div class="action-bar bottom">
	{% include 'display_options.html' %}
	<input name="cur_folder_id" type="hidden" value="{{ CUR_FOLDER_ID }}" >
	{% if message_pagination %}
		{% set pagination = message_pagination %}
		{% include 'pagination.html' %}
	{% else %}
		TEST
	{% endif %}
	<div class="pagination">
		{{ TOTAL_MESSAGES }}
		{% if pagination %}
			{% include 'pagination.html' %}
		{% else %}
			&bull; {{ PAGE_NUMBER }}
		{% endif %}
	</div>
</div>
{% endif %}

{% include 'ucp_pm_message_footer.html' %}
{% include 'ucp_footer.html' %}

<!--WIP-->
<!--<script src="https://cdn.jsdelivr.net/momentjs/2.13.0/moment.min.js"></script>-->
<!--<script>-->
	<!--var date = '2015-04-03';-->
	<!--var format = 'LLLL';-->
	<!--var egg = moment(date).format(format);-->
	<!--document.getElementById("pm-time").innerHTML = egg;-->
	<!--alert(egg);-->
<!--</script>-->
<script>
	var modal = document.getElementById('pm-smile-model');
	var btn = document.getElementById("pm-smile-button");
	var span = document.getElementsByClassName("pm-button-close")[0];

	var to_modal = document.getElementById('pm-to-model');
	var to_btn = document.getElementById("pm-to-button");
	var to_span = document.getElementsByClassName("pm-to-button-close")[0];

	// When the user clicks the button, open the modal
	btn.onclick = function() {
		modal.style.display = "block";
	}

	// When the user clicks on <span> (x), close the modal
	span.onclick = function() {
		modal.style.display = "none";
	}

	// When the user clicks anywhere outside of the modal, close it
	window.onclick = function(event) {
		if (event.target == modal) {
			modal.style.display = "none";
		}
	}

	// When the user clicks the button, open the modal
	to_btn.onclick = function() {
		to_modal.style.display = "block";
	}

	// When the user clicks on <span> (x), close the modal
	to_span.onclick = function() {
		to_modal.style.display = "none";
	}

	// When the user clicks anywhere outside of the modal, close it
	window.onclick = function(event) {
		if (event.target == to_modal) {
			to_modal.style.display = "none";
		}
	}
</script>
